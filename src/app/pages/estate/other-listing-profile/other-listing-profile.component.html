<div class="container-fluid">
  <div class="row">
    <div class="col-xl-4">
      <div class="card overflow-hidden">
        <div class="bg-soft bg-primary">
          <div class="row">
            <div class="col-8">
              <div class="text-primary p-3">
                <h5 class="text-primary">Estate Profile</h5>
                <p class="mb-4">View and Edit Profile</p>
              </div>
            </div>

            <div class="col-4 mr-4">
              <div class="mt-4">
                <button
                  style="
                    display: flex;
                    flex-direction: row;
                    align-items: center;
                    float: right;
                    margin-right: 1rem;
                  "
                  class="btn btn-primary btn-rounded btn-sm"
                  (click)="viewEstateDetail(editEstateTemplate)"
                >
                  Edit Estate
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body pt-0">
          <div class="row">
            <div class="col-sm-4 mt-4">
              <h5 class="font-size-15 text-truncate">
                {{ estate?.name }}
              </h5>
            </div>

            <div class="col-sm-8">
              <div class="pt-4">
                <div class="row">
                  <div class="col-6">
                    <p class="text-muted mb-0 text-center">
                      Total Property Templates
                    </p>
                    <h5 class="font-size-13 text-center">
                      {{ estate?.propertyTemplates?.length ?? 0 | number }}
                    </h5>
                  </div>
                  <div class="col-6">
                    <p class="text-muted mb-0 text-center">Total Properties</p>
                    <br />
                    <h5 class="font-size-13 text-center">
                      {{
                        (properties$ | async)?.data?.properties.length | number
                      }}
                    </h5>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <h4 class="card-title mb-4">Estate Information</h4>
          <div>
            <p style="margin: 0px"><strong>Description :</strong></p>
            <br />
            <div [innerHTML]="estate?.description"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-8">
      <div class="card">
        <div class="card-body">
          <ng-container *ngIf="!showPropertyTemplateInfo">
            <ul
              ngbNav
              #nav1="ngbNav"
              [activeId]="1"
              class="nav-pills bg-light rounded"
            >
              <li [ngbNavItem]="1">
                <a ngbNavLink>Property Templates</a>
                <ng-template ngbNavContent>
                  <ngx-simplebar style="height: auto">
                    <div class="card">
                      <div class="row p-4">
                        <div class="col-6">
                          <h4
                            class="card-title"
                            style="padding: 0px; font-size: 1.5rem"
                          >
                            Property Templates
                          </h4>
                          <p style="font-size: 1rem">
                            List all property templates.
                          </p>
                        </div>
                        <div class="col-6">
                          <button
                            class="btn btn-primary btn-rounded text-right"
                            style="
                              display: flex;
                              flex-direction: row;
                              align-items: center;
                              float: right;
                            "
                            (click)="
                              createPropertyTemplateModal(
                                createPropertyTemplateRecordModal
                              )
                            "
                          >
                            <span style="margin-left: 6px"
                              >Create Property Template</span
                            >
                          </button>
                        </div>
                      </div>
                      <div class="card-body">
                        <div class="row mb-3">
                          <div class="col-12">
                            <!-- search field goes here -->
                          </div>
                        </div>

                        <div
              class="table-responsive"
              style="overflow-x: auto; max-width: 100%"
            >
              <table
                class="table align-middle gs-0 gy-4"
                style="width: max-content; min-width: 100%"
              >
                            <thead>
                              <tr class="fw-bolder text-white bg-primary">
                                <th
                                  class="min-w-10px text-gray-900 text-end rounded-end"
                                ></th>
                                <th class="min-w-100px text-gray-900">
                                  Template Name
                                </th>
                                <th class="min-w-50px text-gray-900">
                                  Property Type
                                </th>
                                <th class="min-w-50px text-gray-900">
                                  Property Sub Type
                                </th>
                                <th class="min-w-50px text-gray-900">Status</th>
                                <th class="min-w-100px text-gray-900">
                                  Created At
                                </th>
                                <th class="min-w-100px text-gray-900"></th>
                              </tr>
                            </thead>
                            <tbody>
                              <ng-container *ngIf="data != null">
                                <tr
                                  *ngFor="let item of estate?.propertyTemplates"
                                >
                                  <td class="text-end">
                                    <a
                                      (click)="viewPropertyTemplateRecord(item)"
                                      style="cursor: pointer"
                                    >
                                      <i class="bx bx-pointer"></i>
                                      Edit
                                    </a>
                                  </td>
                                  <td>
                                    {{ item.templateName }}
                                  </td>
                                  <td>
                                    {{ item.type.name }}
                                  </td>
                                  <td>
                                    {{ item.subType.name }}
                                  </td>
                                  <td>Active</td>
                                  <td>
                                    {{ item?.createdAt | date }}
                                  </td>
                                </tr>
                              </ng-container>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </ngx-simplebar>
                </ng-template>
              </li>
              <li [ngbNavItem]="2">
                <a ngbNavLink>Properties</a>
                <ng-template ngbNavContent>
                  <ngx-simplebar style="height: auto">
                    <div class="card">
                      <div class="row p-4">
                        <div class="col-6">
                          <h4
                            class="card-title"
                            style="padding: 0px; font-size: 1.5rem"
                          >
                            Properties Listings
                          </h4>
                          <p style="font-size: 1rem">List all properties.</p>
                        </div>
                        <div class="col-6">
                          <button
                            class="btn btn-primary btn-rounded text-right"
                            style="
                              display: flex;
                              flex-direction: row;
                              align-items: center;
                              float: right;
                            "
                            (click)="
                              createPropertyModal(createPropertyRecordModal)
                            "
                          >
                            <span style="margin-left: 6px"
                              >Create Property</span
                            >
                          </button>
                        </div>
                      </div>
                      <div class="card-body">
                        <div class="row mb-3">
                          <div class="col-12">
                            <!-- search field goes here -->
                          </div>
                        </div>

                        <div
              class="table-responsive"
              style="overflow-x: auto; max-width: 100%"
            >
              <table
                class="table align-middle gs-0 gy-4"
                style="width: max-content; min-width: 100%"
              >
                            <thead>
                              <tr class="fw-bolder text-white bg-primary">
                                <th
                                  class="min-w-10px text-gray-900 text-end rounded-end"
                                ></th>
                                <th class="min-w-100px text-gray-900">
                                  Property
                                </th>
                                <th class="min-w-100px text-gray-900">Plot</th>
                                <th class="min-w-100px text-gray-900">
                                  Purpose
                                </th>
                                <th class="min-w-100px text-gray-900">
                                  Location
                                </th>
                                <th class="min-w-50px text-gray-900">Status</th>
                                <th class="min-w-100px text-gray-900">
                                  Created At
                                </th>
                                <th class="min-w-100px text-gray-900"></th>
                              </tr>
                            </thead>
                            <tbody>
                              <ng-container
                                *ngIf="
                                  (properties$ | async)?.data?.properties !=
                                  null
                                "
                              >
                                <tr
                                  *ngFor="
                                    let item of (properties$ | async)?.data
                                      ?.properties
                                  "
                                >
                                  <td class="text-end">
                                    <a
                                      *ngIf="item.status === 'Available'"
                                      (click)="
                                        updatePropertyModal(
                                          editPropertyTemplate,
                                          item
                                        )
                                      "
                                      style="cursor: pointer"
                                    >
                                      <i class="bx bx-pointer"></i>
                                      Edit
                                    </a>
                                  </td>
                                  <td>
                                    {{ item?.propertyTemplate?.templateName }}
                                  </td>
                                  <td>
                                    {{ item?.name }}
                                  </td>
                                  <td>
                                    {{ item?.propertyPurpose?.purpose }}
                                  </td>
                                  <td>
                                    {{ item?.propertyLocation?.name }}
                                  </td>
                                  <td>
                                    {{ item?.status }}
                                  </td>
                                  <td>
                                    {{ item?.createdAt | date }}
                                  </td>
                                </tr>
                              </ng-container>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </ngx-simplebar>
                </ng-template>
              </li>
              <li [ngbNavItem]="3">
                <a ngbNavLink>Direct Sales Commission</a>
                <ng-template ngbNavContent>
                  <ngx-simplebar style="height: auto">
                    <div class="card col-lg-12 h-50">
                      <div class="row p-4">
                        <div class="col-6">
                          <h3
                            class="card-title d-flex align-items-start flex-column"
                          >
                            <span class="card-label fw-bolder fs-5 mb-1"
                              >Direct Sale Commissions</span
                            >
                            <span class="text-muted mt-1 fw-bold fs-7"
                              >List all direct sale commissions</span
                            >
                          </h3>
                        </div>

                        <div class="col-6">
                          <button
                            (click)="
                              showCreateDirectSaleCommissionModal(
                                createDirectSaleCommissionTemplate
                              )
                            "
                            class="btn btn-primary btn-rounded"
                            style="
                              display: flex;
                              flex-direction: row;
                              align-items: center;
                              margin-right: 1rem;
                              float: right;
                            "
                          >
                            <span style="margin-left: 6px">
                              Update Direct Sale Commission
                            </span>
                          </button>
                        </div>
                      </div>

                      <div class="card-body py-3" style="padding: 0px 0px">
                        <div class="row">
                          <div
              class="table-responsive"
              style="overflow-x: auto; max-width: 100%"
            >
              <table
                class="table align-middle gs-0 gy-4"
                style="width: max-content; min-width: 100%"
              >
                              <thead>
                                <tr class="fw-bolder text-white bg-primary">
                                  <th
                                    class="min-w-20px text-gray-900 text-center"
                                  >
                                    ID
                                  </th>
                                  <th
                                    class="min-w-350px text-gray-900 text-center"
                                  >
                                    Commission
                                  </th>
                                  <th
                                    class="min-w-350px text-gray-900 text-center"
                                  >
                                    Status
                                  </th>
                                  <th class="min-w-100px text-gray-900">
                                    Created By
                                  </th>
                                  <th class="min-w-100px text-gray-900">
                                    Created At
                                  </th>
                                </tr>
                              </thead>
                              <tbody>
                                <ng-container
                                  *ngIf="
                                    (directSaleCommissions$ | async)?.data
                                      ?.directCommissions?.length > 0
                                  "
                                >
                                  <tr
                                    *ngFor="
                                      let item of (
                                        directSaleCommissions$ | async
                                      )?.data?.directCommissions
                                    "
                                  >
                                    <td class="text-center">
                                      {{ item.id }}
                                    </td>
                                    <td class="text-center">
                                      {{ item.commission | number }}
                                    </td>
                                    <td class="text-center">
                                      {{ item.status }}
                                    </td>
                                    <td>
                                      {{ item?.firstName }} {{ item?.lastName }}
                                    </td>
                                    <td>
                                      {{ item?.createdAt | date }}
                                    </td>
                                  </tr>
                                </ng-container>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ngx-simplebar>
                </ng-template>
              </li>
              <li [ngbNavItem]="4">
                <a ngbNavLink>Indirect Sales Commission</a>
                <ng-template ngbNavContent>
                  <ngx-simplebar style="height: auto">
                    <div class="card col-lg-12 h-50">
                      <div class="row p-4">
                        <div class="col-6">
                          <h3
                            class="card-title d-flex align-items-start flex-column"
                          >
                            <span class="card-label fw-bolder fs-5 mb-1"
                              >Indirect Sale Commissions</span
                            >
                            <span class="text-muted mt-1 fw-bold fs-7"
                              >List all indirect sale commissions</span
                            >
                          </h3>
                        </div>

                        <div class="col-6">
                          <button
                            (click)="
                              showCreateIndirectSaleCommissionModal(
                                createIndirectSaleCommissionTemplate
                              )
                            "
                            class="btn btn-primary btn-rounded"
                            style="
                              display: flex;
                              flex-direction: row;
                              align-items: center;
                              margin-right: 1rem;
                              float: right;
                            "
                          >
                            <span style="margin-left: 6px">
                              Update Indirect Sale Commission
                            </span>
                          </button>
                        </div>
                      </div>

                      <div class="card-body py-3" style="padding: 0px 0px">
                        <div class="row">
                          <div
              class="table-responsive"
              style="overflow-x: auto; max-width: 100%"
            >
              <table
                class="table align-middle gs-0 gy-4"
                style="width: max-content; min-width: 100%"
              >
                              <thead>
                                <tr class="fw-bolder text-white bg-primary">
                                  <th
                                    class="min-w-20px text-gray-900 text-center"
                                  >
                                    ID
                                  </th>
                                  <th
                                    class="min-w-350px text-gray-900 text-center"
                                  >
                                    Commission
                                  </th>
                                  <th
                                    class="min-w-350px text-gray-900 text-center"
                                  >
                                    Status
                                  </th>
                                  <th class="min-w-100px text-gray-900">
                                    Created By
                                  </th>
                                  <th class="min-w-100px text-gray-900">
                                    Created At
                                  </th>
                                </tr>
                              </thead>
                              <tbody>
                                <ng-container
                                  *ngIf="
                                    (indirectSaleCommissions$ | async)?.data?.indirectCommissions?.length >
                                    0
                                  "
                                >
                                  <tr
                                    *ngFor="
                                      let item of (indirectSaleCommissions$
                                        | async)?.data?.indirectCommissions
                                    "
                                  >
                                    <td class="text-center">
                                      {{ item.id }}
                                    </td>
                                    <td class="text-center">
                                      {{ item.commission | number }}
                                    </td>
                                    <td class="text-center">
                                      {{ item.status }}
                                    </td>
                                    <td>
                                      {{ item?.firstName }} {{ item?.lastName }}
                                    </td>
                                    <td>
                                      {{ item?.createdAt | date }}
                                    </td>
                                  </tr>
                                </ng-container>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ngx-simplebar>
                </ng-template>
              </li>
            </ul>
            <div [ngbNavOutlet]="nav1" class="mt-4"></div>
          </ng-container>

          <ng-container *ngIf="showPropertyTemplateInfo">
            <div
              style="
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                margin-bottom: 1rem;
              "
            >
              <div class="fw-bold fs-5 text-gray-800 mb-4">
                Property Template Detail
              </div>
              <a
                (click)="closeDetail()"
                class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1"
                style="cursor: pointer"
              >
                <!-- <app-keenicon name="abstract-11" class="fs-3"></app-keenicon> -->
                Close Details
              </a>
            </div>

            <div class="d-flex flex-wrap flex-sm-nowrap mb-3">
              <!-- <div class="me-7 mb-4">
                <div
                  class="symbol symbol-100px symbol-lg-70px symbol-fixed position-relative"
                >
                  <img
                    src="./assets/images/users/default-img.jpg"
                    width="50px"
                    alt="Metronic"
                  />
                  <div
                    class="position-absolute translate-middle bottom-0 start-100 mb-6 bg-success rounded-circle border border-4 border-white h-20px w-20px"
                  ></div>
                </div>
              </div> -->

              <div style="margin-left: 1rem" class="flex-grow-1">
                <div
                  class="d-flex justify-content-between align-items-start flex-wrap mb-2"
                >
                  <div class="d-flex flex-column">
                    <div class="d-flex align-items-center mb-2">
                      <a
                        class="text-gray-800 text-primary fs-5 fw-bolder me-1 cursor-pointer"
                      >
                        {{ propertyTemplate?.templateName }}
                      </a>

                      <a
                        class="btn btn-sm btn-primary"
                        (click)="
                          showUpdatePropertyTemplateModal(
                            updatePropertyTemplate
                          )
                        "
                        style="cursor: pointer"
                        >Edit</a
                      >
                    </div>

                    <div class="d-flex flex-wrap fw-bold fs-6 mb-1 pe-2">
                      <a
                        class="d-flex align-items-center text-black-500 me-5 mb-2 cursor-pointer"
                        style="font-size: 12px; color: black"
                      >
                        Created By: {{ propertyTemplate?.createdBy }}
                      </a>
                      <a
                        class="d-flex align-items-center text-black-500 mb-2 cursor-pointer"
                        style="font-size: 12px; color: black"
                      >
                        Created At:
                        {{ propertyTemplate?.createdAt | date }}
                      </a>
                    </div>
                  </div>
                </div>

                <div class="d-flex flex-wrap flex-stack">
                  <div class="d-flex flex-column flex-grow-1 pe-8">
                    <div class="row fw-bold fs-6 mb-4">
                      <div class="col-lg-3 fv-row mb-3">
                        <label class="fw-semibold fs-6 mb-2">
                          Property Type
                        </label>
                        <br />
                        {{ propertyTemplate?.type?.name }}
                      </div>
                      <div class="col-lg-3 fv-row mb-3">
                        <label class="fw-semibold fs-6 mb-2">
                          Property Sub-Type
                        </label>
                        <br />
                        {{ propertyTemplate?.subType?.name }}
                      </div>
                      <div class="col-lg-3 fv-row mb-3">
                        <label class="fw-semibold fs-6 mb-2">
                          Building Structure
                        </label>
                        <br />
                        {{ propertyTemplate?.buildingStructure }}
                      </div>
                      <div class="col-lg-3 fv-row mb-3">
                        <label class="fw-semibold fs-6 mb-2"> Map Url </label>
                        <br />
                        {{ propertyTemplate?.mapUrl }}
                      </div>
                      <div class="col-lg-3 fv-row mb-3">
                        <label class="fw-semibold fs-6 mb-2"> Land Size </label>
                        <br />
                        {{ propertyTemplate?.size }}
                      </div>
                      <div class="col-lg-3 fv-row mb-3">
                        <label class="fw-semibold fs-6 mb-2">
                          Current Property Price
                        </label>
                        <br />
                        {{ getAcivePrice(propertyTemplate?.prices) | number }}
                      </div>
                      <div class="col-lg-3 fv-row mb-3">
                        <label class="fw-semibold fs-6 mb-2">
                          Negotiation Status
                        </label>
                        <br />
                        {{ propertyTemplate?.negotiationStatus?.name }}
                      </div>
                    </div>
                    <div class="row fw-bold mb-3">
                      <div class="col-lg-3 fv-row">
                        <label class="fw-semibold fs-6 mb-2">
                          Facilities
                        </label>
                        <br />
                        {{ getFacilityNames(propertyTemplate?.facilityItems) }}
                      </div>
                    </div>
                    <div class="row fw-bold mb-4">
                      <div class="col-lg-3 fv-row">
                        <label class="fw-semibold fs-6 mb-2">
                          Property Documents
                        </label>
                        <br />
                        {{ getFacilityNames(propertyTemplate?.facilityItems) }}
                      </div>
                    </div>
                    <div class="row fw-bold g-2 mb-4">
                      <div
                        *ngFor="let image of [estate.imageUrl]; let i = index"
                        class="col-auto position-relative"
                      >
                        <div
                          class="image-container"
                          style="width: 125px; height: 125px"
                        >
                          <img
                            [src]="image"
                            style="width: 125px; height: 125px"
                            class="img-fluid rounded object-fit-cover"
                            alt="Estate Image"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="row fw-bold g-3">
                      <div class="col-lg-12 fv-row mb-7">
                        <label class="fw-semibold fs-6 mb-2">
                          Property Prototype
                        </label>
                        <br />
                        <div [innerHTML]="propertyTemplate?.description"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="d-flex overflow-auto h-55px">
              <ul
                class="nav nav-stretch nav-line-tabs nav-line-tabs-2x border-transparent fs-5 fw-bold flex-nowrap"
              >
                <li class="nav-item">
                  <a
                    (click)="toggleTab('prices')"
                    class="nav-link text-active-primary me-2"
                    [ngClass]="{
                      'active-tab': tabType == 'prices'
                    }"
                    [ngStyle]="{
                      'background-color':
                        tabType == 'prices' ? '#450000' : 'transparent',
                      color: tabType == 'prices' ? 'white' : 'inherit',
                      'border-bottom-color': '#450000',
                      cursor: 'pointer',
                      borderRadius: '5px',
                      fontSize: '.75rem',
                      padding: '0.5rem 1rem'
                    }"
                  >
                    Property Price
                  </a>
                </li>
              </ul>
            </div>

            <ng-container *ngIf="tabType == 'prices'">
              <div class="card col-lg-12 h-50">
                <div class="row p-4">
                  <div class="col-12">
                    <h3 class="card-title d-flex align-items-start flex-column">
                      <span class="card-label fw-bolder fs-5 mb-1"
                        >Property Price History</span
                      >
                      <span class="text-muted mt-1 fw-bold fs-7"
                        >List property price history</span
                      >
                    </h3>
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <button
                      (click)="
                        showCreatePropertyTemplatePriceModal(
                          createPropertyTemplatePriceTemplate
                        )
                      "
                      class="btn btn-primary btn-rounded"
                      style="
                        display: flex;
                        flex-direction: row;
                        align-items: center;
                        margin-right: 1rem;
                        float: right;
                      "
                    >
                      <span style="margin-left: 6px">
                        Update Property Price
                      </span>
                    </button>
                  </div>
                </div>

                <div class="card-body py-3" style="padding: 0px 0px">
                  <div class="row">
                    <div
              class="table-responsive"
              style="overflow-x: auto; max-width: 100%"
            >
              <table
                class="table align-middle gs-0 gy-4"
                style="width: max-content; min-width: 100%"
              >
                        <thead>
                          <tr class="fw-bolder text-white bg-primary">
                            <th class="min-w-20px text-gray-900 text-center">
                              ID
                            </th>
                            <th class="min-w-350px text-gray-900 text-center">
                              Property Price
                            </th>
                            <th class="min-w-350px text-gray-900 text-center">
                              Status
                            </th>
                            <th class="min-w-100px text-gray-900">
                              Created By
                            </th>
                            <th class="min-w-100px text-gray-900">
                              Created At
                            </th>
                          </tr>
                        </thead>
                        <tbody>
                          <ng-container *ngIf="(prices$ | async)?.length > 0">
                            <tr *ngFor="let item of prices$ | async">
                              <td class="text-center">
                                {{ item.id }}
                              </td>
                              <td class="text-center">
                                {{ item.price | number }}
                              </td>
                              <td class="text-center">
                                {{ item.status }}
                              </td>
                              <td>
                                {{ item?.firstName }} {{ item?.lastName }}
                              </td>
                              <td>
                                {{ item?.createdAt | date }}
                              </td>
                            </tr>
                          </ng-container>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #editEstateTemplate let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel">Create Estate</h5>
    <button
      type="button"
      class="btn-close"
      (click)="closeModal()"
      aria-label="Close"
    ></button>
  </div>
  <div class="modal-body">
    <form #form="ngForm">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
          <div class="mb-3">
            <label
              for="name"
              [class.text-danger]="name.invalid &amp;&amp; name.touched"
              class="form-label"
              >Estate Name <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              name="name"
              #name="ngModel"
              [(ngModel)]="estate.name"
              [class.is-invalid]="name.invalid &amp;&amp; name.touched"
              placeholder="Enter Estate Name"
              required
            />

            <div *ngIf="name.invalid &amp;&amp; name.touched">
              <small *ngIf="name.errors?.required" class="text-danger"
                >Estate Name is Required</small
              >
            </div>
          </div>
        </div>

        <div class="row g-3">
          <div
            *ngFor="let image of [estate.imageUrl]; let i = index"
            class="col-auto position-relative"
          >
            <div class="image-container" style="width: 125px; height: 125px">
              <img
                [src]="image"
                class="img-fluid rounded object-fit-cover"
                alt="Estate Image"
              />
              <button
                type="button"
                class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1 p-0 rounded-circle"
                style="width: 25px; height: 25px"
                (click)="removeImg(image.id, i)"
              >
                <i class="bi bi-x"></i>
              </button>
            </div>
          </div>
        </div>

        <label class="form-label"
          >Images <span class="text-danger">*</span></label
        >
        <div class="col-lg-12 col-md-12 col-sm-12">
          <ngx-dropzone [multiple]="false" (change)="onSelect($event)">
            <ngx-dropzone-label>Drop images!</ngx-dropzone-label>

            <ngx-dropzone-image-preview
              ngProjectAs="ngx-dropzone-preview"
              *ngFor="let f of files"
              [file]="f"
              required
            >
              <ngx-dropzone-label>
                {{ f.name }} ({{ f.type }})
              </ngx-dropzone-label>
            </ngx-dropzone-image-preview>
          </ngx-dropzone>
        </div>

        <div class="col-lg-12 col-md-12 col-sm-12 mt-4">
          <div class="mb-3">
            <label
              for="description"
              [class.text-danger]="description.invalid &amp;&amp; description.touched"
              class="form-label"
              >Property Description/Prototype
              <span class="text-danger">*</span></label
            >
            <ckeditor
              [editor]="Editor"
              [data]="estate.description"
              name="description"
              #description="ngModel"
              [(ngModel)]="estate.description"
              required
            ></ckeditor>

            <div *ngIf="description.invalid &amp;&amp; description.touched">
              <small *ngIf="description.errors?.required" class="text-danger"
                >Estate Description is Required</small
              >
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          *ngIf="!isLoading"
          class="btn btn-primary btn-rounded"
          (click)="onUpdateEstate()"
          [disabled]="form.invalid"
        >
          Submit
        </button>
        <button
          *ngIf="!isLoading"
          class="btn btn-danger btn-rounded"
          (click)="closeModal()"
        >
          Cancel
        </button>
        <button
          *ngIf="isLoading"
          class="btn  btn-primary btn-rounded"
          disabled
        >
          Processing <span><i class="bx bx-loader bx-spin"></i></span>
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #createPropertyTemplateRecordModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel">Create Estate</h5>
    <button
      type="button"
      class="btn-close"
      (click)="closeModal()"
      aria-label="Close"
    ></button>
  </div>
  <div class="modal-body">
    <form #form="ngForm">
      <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="templateName"
              [class.text-danger]="templateName.invalid &amp;&amp; templateName.touched"
              class="form-label"
              >Property Template Name <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              name="templateName"
              #templateName="ngModel"
              [(ngModel)]="obj.templateName"
              [class.is-invalid]="templateName.invalid &amp;&amp; templateName.touched"
              placeholder="Enter Property Template Name"
              required
            />

            <div *ngIf="templateName.invalid &amp;&amp; templateName.touched">
              <small *ngIf="templateName.errors?.required" class="text-danger"
                >Property Template Name is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="propertyTypeId"
              [class.text-danger]="propertyTypeId.invalid &amp;&amp; propertyTypeId.touched"
              class="form-label"
              >Property Type <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(propertyTypes$ | async)?.data"
              bindValue="id"
              bindLabel="name"
              name="propertyTypeId"
              #propertyTypeId="ngModel"
              [(ngModel)]="obj.propertyTypeId"
              [class.is-invalid]="propertyTypeId.invalid &amp;&amp; propertyTypeId.touched"
              placeholder="--Select Property Type--"
              (change)="onSelectPropertyType($event)"
              required
            ></ng-select>

            <div
              *ngIf="propertyTypeId.invalid &amp;&amp; propertyTypeId.touched"
            >
              <small *ngIf="propertyTypeId.errors?.required" class="text-danger"
                >Property Type is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="propertySubTypeId"
              [class.text-danger]="propertySubTypeId.invalid &amp;&amp; propertySubTypeId.touched"
              class="form-label"
              >Property Sub-Type <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="propertySubTypeList"
              bindValue="id"
              bindLabel="name"
              name="propertySubTypeId"
              #propertySubTypeId="ngModel"
              [(ngModel)]="obj.propertySubTypeId"
              [class.is-invalid]="propertySubTypeId.invalid &amp;&amp; propertySubTypeId.touched"
              placeholder="--Select Property Sub-Type--"
              required
            ></ng-select>

            <div
              *ngIf="propertySubTypeId.invalid &amp;&amp; propertySubTypeId.touched"
            >
              <small
                *ngIf="propertySubTypeId.errors?.required"
                class="text-danger"
                >Property Sub-Type is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="buildingStructure"
              [class.text-danger]="buildingStructure.invalid &amp;&amp; buildingStructure.touched"
              class="form-label"
              >Building Structure <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="buildingStructures"
              bindValue="name"
              bindLabel="name"
              name="buildingStructure"
              #buildingStructure="ngModel"
              [(ngModel)]="obj.buildingStructure"
              [class.is-invalid]="buildingStructure.invalid &amp;&amp; buildingStructure.touched"
              placeholder="--Select Estate--"
              required
            ></ng-select>

            <div
              *ngIf="buildingStructure.invalid &amp;&amp; buildingStructure.touched"
            >
              <small
                *ngIf="buildingStructure.errors?.required"
                class="text-danger"
                >Building Structure is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="mapUrl"
              [class.text-danger]="mapUrl.invalid &amp;&amp; mapUrl.touched"
              class="form-label"
              >Map Url <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              name="mapUrl"
              #mapUrl="ngModel"
              [(ngModel)]="obj.mapUrl"
              [class.is-invalid]="mapUrl.invalid &amp;&amp; mapUrl.touched"
              placeholder="Enter Map Url"
              required
            />

            <div *ngIf="mapUrl.invalid &amp;&amp; mapUrl.touched">
              <small *ngIf="mapUrl.errors?.required" class="text-danger"
                >Map Url is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="size"
              [class.text-danger]="size.invalid &amp;&amp; size.touched"
              class="form-label"
              >Land Size <span class="text-danger">*</span>(in square
              meter)</label
            >
            <input
              type="number"
              class="form-control"
              name="size"
              #size="ngModel"
              [(ngModel)]="obj.size"
              [class.is-invalid]="size.invalid &amp;&amp; size.touched"
              placeholder="Enter Land Size"
              required
            />

            <div *ngIf="size.invalid &amp;&amp; size.touched">
              <small *ngIf="size.errors?.required" class="text-danger"
                >Land Size is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="prices"
              [class.text-danger]="prices.invalid &amp;&amp; prices.touched"
              class="form-label"
              >Property Price <span class="text-danger">*</span></label
            >
            <input
              type="number"
              class="form-control"
              name="prices"
              #prices="ngModel"
              [(ngModel)]="obj.propertyPrice"
              [class.is-invalid]="prices.invalid &amp;&amp; prices.touched"
              placeholder="Enter Property price"
              required
            />

            <div *ngIf="prices.invalid &amp;&amp; prices.touched">
              <small *ngIf="size.errors?.required" class="text-danger"
                >Property price is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="negotiationStatusId"
              [class.text-danger]="negotiationStatusId.invalid &amp;&amp; negotiationStatusId.touched"
              class="form-label"
              >Negotiation Status <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(negotiationStatus$ | async)?.data"
              bindValue="id"
              bindLabel="name"
              name="negotiationStatusId"
              #negotiationStatusId="ngModel"
              [(ngModel)]="obj.negotiationStatusId"
              [class.is-invalid]="negotiationStatusId.invalid &amp;&amp; negotiationStatusId.touched"
              placeholder="--Select Negotiation Status--"
              required
            ></ng-select>

            <div
              *ngIf="negotiationStatusId.invalid &amp;&amp; negotiationStatusId.touched"
            >
              <small
                *ngIf="negotiationStatusId.errors?.required"
                class="text-danger"
                >Negotiation Status is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-12 col-md-12 col-sm-12">
          <div class="mb-3">
            <label
              for="facilities"
              [class.text-danger]="facilities.invalid &amp;&amp; facilities.touched"
              class="form-label"
              >Property Facilities <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(facilities$ | async)?.data"
              [multiple]="true"
              bindValue="id"
              bindLabel="name"
              name="facilities"
              #facilities="ngModel"
              [(ngModel)]="obj.facilities"
              [class.is-invalid]="facilities.invalid &amp;&amp; facilities.touched"
              placeholder="--Select Property Facilities--"
              required
            ></ng-select>

            <div *ngIf="facilities.invalid &amp;&amp; facilities.touched">
              <small *ngIf="facilities.errors?.required" class="text-danger"
                >Property Facilities is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-12 col-md-12 col-sm-12">
          <div class="mb-3">
            <label
              for="titles"
              [class.text-danger]="titles.invalid &amp;&amp; titles.touched"
              class="form-label"
              >Property Titles <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="propertyTitles"
              [multiple]="true"
              bindValue="name"
              bindLabel="name"
              name="titles"
              #titles="ngModel"
              [(ngModel)]="obj.titles"
              [class.is-invalid]="titles.invalid &amp;&amp; titles.touched"
              placeholder="--Select Property Titles--"
              required
            ></ng-select>

            <div *ngIf="titles.invalid &amp;&amp; titles.touched">
              <small *ngIf="titles.errors?.required" class="text-danger"
                >Property Titles is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-12 col-md-12 col-sm-12">
          <ngx-dropzone [multiple]="false" (change)="onSelect($event)">
            <ngx-dropzone-label>Drop images!</ngx-dropzone-label>

            <ngx-dropzone-image-preview
              ngProjectAs="ngx-dropzone-preview"
              *ngFor="let f of files"
              [file]="f"
              required
            >
              <ngx-dropzone-label
                >{{ f.name }} ({{ f.type }})</ngx-dropzone-label
              >
            </ngx-dropzone-image-preview>
          </ngx-dropzone>
        </div>

        <div class="col-lg-12 col-md-12 col-sm-12 mt-4">
          <div class="mb-3">
            <label
              for="description"
              [class.text-danger]="description.invalid &amp;&amp; description.touched"
              class="form-label"
              >Property Description/Prototype
              <span class="text-danger">*</span></label
            >
            <ckeditor
              [editor]="Editor"
              [data]="obj.description"
              name="description"
              #description="ngModel"
              [(ngModel)]="obj.description"
            ></ckeditor>

            <div *ngIf="description.invalid &amp;&amp; description.touched">
              <small *ngIf="description.errors?.required" class="text-danger"
                >Estate Description is Required</small
              >
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          *ngIf="!isLoading"
          class="btn btn-primary btn-rounded"
          [disabled]="form.invalid || files.length === 0"
          (click)="onSubmit()"
        >
          Submit
        </button>
        <button
          *ngIf="!isLoading"
          class="btn btn-danger btn-rounded"
          (click)="closeModal()"
        >
          Cancel
        </button>
        <button *ngIf="isLoading" class="btn btn-primary btn-rounded" disabled>
          Processing <span><i class="bx bx-loader bx-spin"></i></span>
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #updatePropertyTemplate let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel">Create Estate</h5>
    <button
      type="button"
      class="btn-close"
      (click)="closeModal()"
      aria-label="Close"
    ></button>
  </div>
  <div class="modal-body">
    <form #form="ngForm">
      <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="templateName"
              [class.text-danger]="templateName.invalid &amp;&amp; templateName.touched"
              class="form-label"
              >Property Template Name <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              name="templateName"
              #templateName="ngModel"
              [(ngModel)]="propertyTemplate.templateName"
              [class.is-invalid]="templateName.invalid &amp;&amp; templateName.touched"
              placeholder="Enter Property Template Name"
              required
            />

            <div *ngIf="templateName.invalid &amp;&amp; templateName.touched">
              <small *ngIf="templateName.errors?.required" class="text-danger"
                >Property Template Name is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="propertyTypeId"
              [class.text-danger]="propertyTypeId.invalid &amp;&amp; propertyTypeId.touched"
              class="form-label"
              >Property Type <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(propertyTypes$ | async)?.data"
              bindValue="id"
              bindLabel="name"
              name="propertyTypeId"
              #propertyTypeId="ngModel"
              [(ngModel)]="propertyTemplate.propertyTypeId"
              [class.is-invalid]="propertyTypeId.invalid &amp;&amp; propertyTypeId.touched"
              placeholder="--Select Property Type--"
              (change)="onSelectPropertyType($event)"
              required
            ></ng-select>

            <div
              *ngIf="propertyTypeId.invalid &amp;&amp; propertyTypeId.touched"
            >
              <small *ngIf="propertyTypeId.errors?.required" class="text-danger"
                >Property Type is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="propertySubTypeId"
              [class.text-danger]="propertySubTypeId.invalid &amp;&amp; propertySubTypeId.touched"
              class="form-label"
              >Property Sub-Type <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="propertySubTypeList"
              bindValue="id"
              bindLabel="name"
              name="propertySubTypeId"
              #propertySubTypeId="ngModel"
              [(ngModel)]="propertyTemplate.propertySubTypeId"
              [class.is-invalid]="propertySubTypeId.invalid &amp;&amp; propertySubTypeId.touched"
              placeholder="--Select Property Sub-Type--"
              required
            ></ng-select>

            <div
              *ngIf="propertySubTypeId.invalid &amp;&amp; propertySubTypeId.touched"
            >
              <small
                *ngIf="propertySubTypeId.errors?.required"
                class="text-danger"
                >Property Sub-Type is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="buildingStructure"
              [class.text-danger]="buildingStructure.invalid &amp;&amp; buildingStructure.touched"
              class="form-label"
              >Building Structure <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="buildingStructures"
              bindValue="name"
              bindLabel="name"
              name="buildingStructure"
              #buildingStructure="ngModel"
              [(ngModel)]="propertyTemplate.buildingStructure"
              [class.is-invalid]="buildingStructure.invalid &amp;&amp; buildingStructure.touched"
              placeholder="--Select Estate--"
              required
            ></ng-select>

            <div
              *ngIf="buildingStructure.invalid &amp;&amp; buildingStructure.touched"
            >
              <small
                *ngIf="buildingStructure.errors?.required"
                class="text-danger"
                >Building Structure is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="mapUrl"
              [class.text-danger]="mapUrl.invalid &amp;&amp; mapUrl.touched"
              class="form-label"
              >Map Url <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              name="mapUrl"
              #mapUrl="ngModel"
              [(ngModel)]="propertyTemplate.mapUrl"
              [class.is-invalid]="mapUrl.invalid &amp;&amp; mapUrl.touched"
              placeholder="Enter Map Url"
              required
            />

            <div *ngIf="mapUrl.invalid &amp;&amp; mapUrl.touched">
              <small *ngIf="mapUrl.errors?.required" class="text-danger"
                >Map Url is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="size"
              [class.text-danger]="size.invalid &amp;&amp; size.touched"
              class="form-label"
              >Land Size <span class="text-danger">*</span>(in square
              meter)</label
            >
            <input
              type="number"
              class="form-control"
              name="size"
              #size="ngModel"
              [(ngModel)]="propertyTemplate.size"
              [class.is-invalid]="size.invalid &amp;&amp; size.touched"
              placeholder="Enter Land Size"
              required
            />

            <div *ngIf="size.invalid &amp;&amp; size.touched">
              <small *ngIf="size.errors?.required" class="text-danger"
                >Land Size is Required</small
              >
            </div>
          </div>
        </div>

        <!-- <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="prices"
              [class.text-danger]="prices.invalid &amp;&amp; prices.touched"
              class="form-label"
              >Property Price <span class="text-danger">*</span></label
            >
            <input
              type="number"
              class="form-control"
              name="prices"
              #prices="ngModel"
              [(ngModel)]="propertyTemplate.propertyPrice"
              [class.is-invalid]="prices.invalid &amp;&amp; prices.touched"
              placeholder="Enter Property price"
              required
            />

            <div *ngIf="prices.invalid &amp;&amp; prices.touched">
              <small *ngIf="size.errors?.required" class="text-danger"
                >Property price is Required</small
              >
            </div>
          </div>
        </div> -->

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="negotiationStatusId"
              [class.text-danger]="negotiationStatusId.invalid &amp;&amp; negotiationStatusId.touched"
              class="form-label"
              >Negotiation Status <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(negotiationStatus$ | async)?.data"
              bindValue="id"
              bindLabel="name"
              name="negotiationStatusId"
              #negotiationStatusId="ngModel"
              [(ngModel)]="propertyTemplate.negotiationStatusId"
              [class.is-invalid]="negotiationStatusId.invalid &amp;&amp; negotiationStatusId.touched"
              placeholder="--Select Negotiation Status--"
              required
            ></ng-select>

            <div
              *ngIf="negotiationStatusId.invalid &amp;&amp; negotiationStatusId.touched"
            >
              <small
                *ngIf="negotiationStatusId.errors?.required"
                class="text-danger"
                >Negotiation Status is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-12 col-md-12 col-sm-12">
          <div class="mb-3">
            <label
              for="facilities"
              [class.text-danger]="facilities.invalid &amp;&amp; facilities.touched"
              class="form-label"
              >Property Facilities <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(facilities$ | async)?.data"
              [multiple]="true"
              bindValue="id"
              bindLabel="name"
              name="facilities"
              #facilities="ngModel"
              [(ngModel)]="propertyTemplate.facilities"
              [class.is-invalid]="facilities.invalid &amp;&amp; facilities.touched"
              placeholder="--Select Property Facilities--"
              required
            ></ng-select>

            <div *ngIf="facilities.invalid &amp;&amp; facilities.touched">
              <small *ngIf="facilities.errors?.required" class="text-danger"
                >Property Facilities is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-12 col-md-12 col-sm-12">
          <div class="mb-3">
            <label
              for="titles"
              [class.text-danger]="titles.invalid &amp;&amp; titles.touched"
              class="form-label"
              >Property Titles <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="propertyTitles"
              [multiple]="true"
              bindValue="name"
              bindLabel="name"
              name="titles"
              #titles="ngModel"
              [(ngModel)]="propertyTemplate.titles"
              [class.is-invalid]="titles.invalid &amp;&amp; titles.touched"
              placeholder="--Select Property Titles--"
              required
            ></ng-select>

            <div *ngIf="titles.invalid &amp;&amp; titles.touched">
              <small *ngIf="titles.errors?.required" class="text-danger"
                >Property Titles is Required</small
              >
            </div>
          </div>
        </div>

        <div class="row g-3 mb-4">
          <div
            *ngFor="let image of propertyTemplate.images; let i = index"
            class="col-auto position-relative"
          >
            <div class="image-container" style="width: 125px; height: 125px">
              <img
                [src]="image?.imageUrl"
                style="width: 125px; height: 125px"
                class="img-fluid rounded object-fit-cover"
                alt="Estate Image"
              />
              <button
                type="button"
                class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1 p-0 rounded-circle"
                style="width: 25px; height: 25px"
                (click)="removeImg(image.id, i)"
              >
                <i class="bi bi-x"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="col-lg-12 col-md-12 col-sm-12">
          <ngx-dropzone [multiple]="false" (change)="onSelect($event)">
            <ngx-dropzone-label>Drop images!</ngx-dropzone-label>

            <ngx-dropzone-image-preview
              ngProjectAs="ngx-dropzone-preview"
              *ngFor="let f of files"
              [file]="f"
              required
            >
              <ngx-dropzone-label
                >{{ f.name }} ({{ f.type }})</ngx-dropzone-label
              >
            </ngx-dropzone-image-preview>
          </ngx-dropzone>
        </div>

        <div class="col-lg-12 col-md-12 col-sm-12 mt-4">
          <div class="mb-3">
            <label
              for="description"
              [class.text-danger]="description.invalid &amp;&amp; description.touched"
              class="form-label"
              >Property Description/Prototype
              <span class="text-danger">*</span></label
            >
            <ckeditor
              [editor]="Editor"
              [data]="propertyTemplate.description"
              name="description"
              #description="ngModel"
              [(ngModel)]="propertyTemplate.description"
            ></ckeditor>

            <div *ngIf="description.invalid &amp;&amp; description.touched">
              <small *ngIf="description.errors?.required" class="text-danger"
                >Estate Description is Required</small
              >
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          *ngIf="!isLoading"
          class="btn btn-primary btn-rounded"
          [disabled]="form.invalid"
          (click)="onUpdatePropertyTemplate()"
        >
          Update
        </button>
        <button
          *ngIf="!isLoading"
          class="btn btn-danger btn-rounded"
          (click)="closeModal()"
        >
          Cancel
        </button>
        <button *ngIf="isLoading" class="btn btn-primary btn-rounded" disabled>
          Processing <span><i class="bx bx-loader bx-spin"></i></span>
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #createPropertyRecordModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel">Create Property/Plot</h5>
    <button
      type="button"
      class="btn-close"
      (click)="closeModal()"
      aria-label="Close"
    ></button>
  </div>
  <div class="modal-body">
    <form #form="ngForm">
      <div class="row">
        <div class="col-lg-12 col-md-12">
          <div class="mb-3">
            <label
              for="propertyTemplateId"
              [class.text-danger]="propertyTemplateId.invalid &amp;&amp; propertyTemplateId.touched"
              class="form-label"
              >Property Template <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(propertyTemplates$ | async)?.data?.propertyTemplates"
              bindValue="id"
              bindLabel="templateName"
              name="propertyTemplateId"
              #propertyTemplateId="ngModel"
              [(ngModel)]="propertyObj.propertyTemplateId"
              [class.is-invalid]="propertyTemplateId.invalid &amp;&amp; propertyTemplateId.touched"
              placeholder="--Select Property Template--"
              (change)="onSelectPropertyType($event)"
              required
            ></ng-select>

            <div
              *ngIf="propertyTemplateId.invalid &amp;&amp; propertyTemplateId.touched"
            >
              <small
                *ngIf="propertyTemplateId.errors?.required"
                class="text-danger"
                >Property Template is Required</small
              >
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-6">
          <h4 class="card-title" style="padding: 0px; font-size: 1rem">
            Property Items
          </h4>
          <p style="font-size: 1rem">List all properties.</p>
        </div>
        <div class="col-6">
          <button
            class="btn btn-primary btn-rounded text-right"
            style="
              display: flex;
              flex-direction: row;
              align-items: center;
              float: right;
            "
            (click)="addItem()"
          >
            <span style="margin-left: 6px">Add Property/Plot</span>
          </button>
        </div>
      </div>

      <div
        class="row"
        *ngFor="let property of propertyObj.properties; index as i"
      >
        <div class="col-lg-12 col-md-12">
          <div class="mb-3">
            <label
              for="propertyName"
              [class.text-danger]="propertyName.invalid &amp;&amp; propertyName.touched"
              class="form-label"
              >Property/Plot Name <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              name="propertyName{{ i }}"
              #propertyName="ngModel"
              [(ngModel)]="property.propertyName"
              [class.is-invalid]="propertyName.invalid &amp;&amp; propertyName.touched"
              placeholder="Enter Property Name"
              required
            />

            <div *ngIf="propertyName.invalid &amp;&amp; propertyName.touched">
              <small *ngIf="propertyName.errors?.required" class="text-danger"
                >Property Name is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="propertyPurposeId"
              [class.text-danger]="propertyPurposeId.invalid &amp;&amp; propertyPurposeId.touched"
              class="form-label"
              >Property Purpose <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(propertyPurpose$ | async)?.data"
              bindValue="id"
              bindLabel="purpose"
              name="propertyPurposeId{{ i }}"
              #propertyPurposeId="ngModel"
              [(ngModel)]="property.propertyPurposeId"
              [class.is-invalid]="propertyPurposeId.invalid &amp;&amp; propertyPurposeId.touched"
              placeholder="--Select Property Purpose--"
              (change)="onSelectPropertyType($event)"
              required
            ></ng-select>

            <div
              *ngIf="propertyPurposeId.invalid &amp;&amp; propertyPurposeId.touched"
            >
              <small
                *ngIf="propertyPurposeId.errors?.required"
                class="text-danger"
                >Property Purpose is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="propertyLocationId"
              [class.text-danger]="propertyLocationId.invalid &amp;&amp; propertyLocationId.touched"
              class="form-label"
              >Property Location <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(propertyLocations$ | async)?.data"
              bindValue="id"
              bindLabel="name"
              name="propertyLocationId{{ i }}"
              #propertyLocationId="ngModel"
              [(ngModel)]="property.propertyLocationId"
              [class.is-invalid]="propertyLocationId.invalid &amp;&amp; propertyLocationId.touched"
              placeholder="--Select Property Location--"
              (change)="onSelectPropertyType($event)"
              required
            ></ng-select>

            <div
              *ngIf="propertyLocationId.invalid &amp;&amp; propertyLocationId.touched"
            >
              <small
                *ngIf="propertyLocationId.errors?.required"
                class="text-danger"
                >Property Location is Required</small
              >
            </div>
          </div>
        </div>

        <div *ngIf="propertyObj.properties.length > 1" class="row mb-4">
          <div class="col-6"></div>
          <div class="col-6">
            <a
              class="text-danger"
              style="
                display: flex;
                flex-direction: row;
                align-items: center;
                float: right;
                cursor: pointer;
              "
            >
              Remove Item<i
                class="bx bx-trash fs-4 text-danger"
                (click)="removeItem(i)"
              ></i>
            </a>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button
          *ngIf="!isLoading"
          class="btn btn-primary btn-rounded"
          [disabled]="form.invalid"
          (click)="onSubmitProperty()"
        >
          Submit
        </button>
        <button
          *ngIf="!isLoading"
          class="btn btn-danger btn-rounded"
          (click)="closeModal()"
        >
          Cancel
        </button>
        <button *ngIf="isLoading" class="btn btn-primary btn-rounded" disabled>
          Processing <span><i class="bx bx-loader bx-spin"></i></span>
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #editPropertyTemplate let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel">Update Property/Plot</h5>
    <button
      type="button"
      class="btn-close"
      (click)="closeModal()"
      aria-label="Close"
    ></button>
  </div>
  <div class="modal-body">
    <!-- {{ updateProperty?.propertyTemplateId | json }} -->
    <form #form="ngForm">
      <div class="row">
        <div class="col-lg-12 col-md-12">
          <div class="mb-3">
            <label
              for="propertyTemplateId"
              [class.text-danger]="propertyTemplateId.invalid &amp;&amp; propertyTemplateId.touched"
              class="form-label"
              >Property Template <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(propertyTemplates$ | async)?.data?.propertyTemplates"
              bindValue="id"
              bindLabel="templateName"
              name="propertyTemplateId"
              #propertyTemplateId="ngModel"
              [(ngModel)]="updateProperty.propertyTemplateId"
              [class.is-invalid]="propertyTemplateId.invalid &amp;&amp; propertyTemplateId.touched"
              placeholder="--Select Property Template--"
              (change)="onSelectPropertyType($event)"
              disabled
            ></ng-select>

            <div
              *ngIf="propertyTemplateId.invalid &amp;&amp; propertyTemplateId.touched"
            >
              <small
                *ngIf="propertyTemplateId.errors?.required"
                class="text-danger"
                >Property Template is Required</small
              >
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-6">
          <h4 class="card-title" style="padding: 0px; font-size: 1rem">
            Property Information
          </h4>
          <p style="font-size: 1rem">Show property Information.</p>
        </div>
      </div>

      <div class="col-lg-12 col-md-12">
        <div class="mb-3">
          <label
            for="propertyName"
            [class.text-danger]="propertyName.invalid &amp;&amp; propertyName.touched"
            class="form-label"
            >Property/Plot Name <span class="text-danger">*</span></label
          >
          <input
            type="text"
            class="form-control"
            name="propertyName"
            #propertyName="ngModel"
            [(ngModel)]="updateProperty.propertyName"
            [class.is-invalid]="propertyName.invalid &amp;&amp; propertyName.touched"
            placeholder="Enter Property Name"
            required
          />

          <div *ngIf="propertyName.invalid &amp;&amp; propertyName.touched">
            <small *ngIf="propertyName.errors?.required" class="text-danger"
              >Property Name is Required</small
            >
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="propertyPurposeId"
              [class.text-danger]="propertyPurposeId.invalid &amp;&amp; propertyPurposeId.touched"
              class="form-label"
              >Property Purpose <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(propertyPurpose$ | async)?.data"
              bindValue="id"
              bindLabel="purpose"
              name="propertyPurposeId"
              #propertyPurposeId="ngModel"
              [(ngModel)]="updateProperty.propertyPurposeId"
              [class.is-invalid]="propertyPurposeId.invalid &amp;&amp; propertyPurposeId.touched"
              placeholder="--Select Property Purpose--"
              (change)="onSelectPropertyType($event)"
              required
            ></ng-select>

            <div
              *ngIf="propertyPurposeId.invalid &amp;&amp; propertyPurposeId.touched"
            >
              <small
                *ngIf="propertyPurposeId.errors?.required"
                class="text-danger"
                >Property Purpose is Required</small
              >
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-12">
          <div class="mb-3">
            <label
              for="propertyLocationId"
              [class.text-danger]="propertyLocationId.invalid &amp;&amp; propertyLocationId.touched"
              class="form-label"
              >Property Location <span class="text-danger">*</span></label
            >
            <ng-select
              [items]="(propertyLocations$ | async)?.data"
              bindValue="id"
              bindLabel="name"
              name="propertyLocationId"
              #propertyLocationId="ngModel"
              [(ngModel)]="updateProperty.propertyLocationId"
              [class.is-invalid]="propertyLocationId.invalid &amp;&amp; propertyLocationId.touched"
              placeholder="--Select Property Location--"
              (change)="onSelectPropertyType($event)"
              required
            ></ng-select>

            <div
              *ngIf="propertyLocationId.invalid &amp;&amp; propertyLocationId.touched"
            >
              <small
                *ngIf="propertyLocationId.errors?.required"
                class="text-danger"
                >Property Location is Required</small
              >
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button
          *ngIf="!isLoading"
          class="btn btn-primary btn-rounded"
          [disabled]="form.invalid"
          (click)="onUpdateProperty()"
        >
          Update
        </button>
        <button
          *ngIf="!isLoading"
          class="btn btn-danger btn-rounded"
          (click)="closeModal()"
        >
          Cancel
        </button>
        <button *ngIf="isLoading" class="btn btn-primary btn-rounded" disabled>
          Processing <span><i class="bx bx-loader bx-spin"></i></span>
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #createPropertyTemplatePriceTemplate let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel">Update Property Price</h5>
    <button
      type="button"
      class="btn-close"
      (click)="closeModal()"
      aria-label="Close"
    ></button>
  </div>
  <div class="modal-body">
    <form #form="ngForm">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
          <div class="mb-3">
            <label
              for="price"
              [class.text-danger]="price.invalid &amp;&amp; price.touched"
              class="form-label"
              >Property price <span class="text-danger">*</span></label
            >
            <input
              type="number"
              class="form-control"
              name="price"
              #price="ngModel"
              [(ngModel)]="propertyTemplatePrice.price"
              [class.is-invalid]="price.invalid &amp;&amp; price.touched"
              placeholder="Enter Property price"
              required
            />

            <div *ngIf="price.invalid &amp;&amp; price.touched">
              <small *ngIf="price.errors?.required" class="text-danger"
                >Property price is Required</small
              >
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          *ngIf="!isLoading"
          class="btn btn-primary btn-rounded"
          [disabled]="form.invalid"
          (click)="onSubmitPropertyTemplatePrice()"
        >
          Submit
        </button>
        <button
          *ngIf="!isLoading"
          class="btn btn-danger btn-rounded"
          (click)="closeModal()"
        >
          Cancel
        </button>
        <button *ngIf="isLoading" class="btn btn-primary btn-rounded" disabled>
          Processing <span><i class="bx bx-loader bx-spin"></i></span>
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #createDirectSaleCommissionTemplate let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel">
      Update Direct Sale Commission
    </h5>
    <button
      type="button"
      class="btn-close"
      (click)="closeModal()"
      aria-label="Close"
    ></button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12">
        <div class="mb-3">
          <label
            for="commission"
            [class.text-danger]="commission.invalid &amp;&amp; commission.touched"
            class="form-label"
            >Direct Sale Commission <span class="text-danger">*</span></label
          >
          <input
            type="number"
            class="form-control"
            name="commission"
            #commission="ngModel"
            [(ngModel)]="directSaleCommission.commission"
            [class.is-invalid]="commission.invalid &amp;&amp; commission.touched"
            placeholder="Enter Commission Percentage"
            required
          />

          <div *ngIf="commission.invalid &amp;&amp; commission.touched">
            <small *ngIf="commission.errors?.required" class="text-danger"
              >Direct sale commission is Required</small
            >
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        *ngIf="!isLoading"
        class="btn btn-primary btn-rounded"
        (click)="onSubmitDirectSaleCommission()"
      >
        Submit
      </button>
      <button
        *ngIf="!isLoading"
        class="btn btn-danger btn-rounded"
        (click)="closeModal()"
      >
        Cancel
      </button>
      <button *ngIf="isLoading" class="btn btn-primary btn-rounded" disabled>
        Processing <span><i class="bx bx-loader bx-spin"></i></span>
      </button>
    </div>
  </div>
</ng-template>

<ng-template #createIndirectSaleCommissionTemplate let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel">
      Update Indirect Sale Commission
    </h5>
    <button
      type="button"
      class="btn-close"
      (click)="closeModal()"
      aria-label="Close"
    ></button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12">
        <div class="mb-3">
          <label
            for="commission"
            [class.text-danger]="commission.invalid &amp;&amp; commission.touched"
            class="form-label"
            >Indirect Sale Commission <span class="text-danger">*</span></label
          >
          <input
            type="number"
            class="form-control"
            name="commission"
            #commission="ngModel"
            [(ngModel)]="indirectSaleCommission.commission"
            [class.is-invalid]="commission.invalid &amp;&amp; commission.touched"
            placeholder="Enter Commission Percentage"
            required
          />

          <div *ngIf="commission.invalid &amp;&amp; commission.touched">
            <small *ngIf="commission.errors?.required" class="text-danger"
              >Indirect sale commission is Required</small
            >
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        *ngIf="!isLoading"
        class="btn btn-primary btn-rounded"
        (click)="onSubmitIndirectSaleCommission()"
      >
        Submit
      </button>
      <button
        *ngIf="!isLoading"
        class="btn btn-danger btn-rounded"
        (click)="closeModal()"
      >
        Cancel
      </button>
      <button *ngIf="isLoading" class="btn btn-primary btn-rounded" disabled>
        Processing <span><i class="bx bx-loader bx-spin"></i></span>
      </button>
    </div>
  </div>
</ng-template>
